<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>è‹±æ¤œ3ç´š å—ã‘èº«ãƒ»å‰ç½®è© ç©ºæ¬„åŸ‹ã‚</title>

<style>
body{
  font-family:"Hiragino Maru Gothic ProN","Hiragino Maru Gothic",sans-serif;
  background:#f6f6f6;
  padding:16px;
}
h1{
  text-align:center;
  font-size:22px;
  margin-bottom:20px;
}

/* å•é¡Œæ  */
.question{
  background:#fff;
  padding:16px;
  margin-bottom:16px;
  border-radius:14px;
  border:3px solid transparent;
}
.question.wrong{
  border-color:#e74c3c;
  background:#fff0f0;
}

/* æ–‡ */
.sentence{
  font-size:20px;
  margin-bottom:12px;
}
.blank{
  display:inline-block;
  min-width:70px;
  border-bottom:2px solid #333;
  text-align:center;
  font-weight:bold;
}

/* é¸æŠè‚¢ */
.choices{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.choice{
  font-size:18px;
  cursor:pointer;
  text-align:center;
  padding:10px;
  border-radius:10px;
  border:2px solid #999;
  background:#fff;
}
.choice.selected{
  background:#dfefff;
  font-weight:bold;
}

/* èª­ã¿ä¸Šã’ */
.speak{
  display:none;
  margin-top:8px;
}

/* æ“ä½œãƒœã‚¿ãƒ³ */
.controls{
  text-align:center;
  margin:20px 0;
}
button{
  font-size:16px;
  padding:8px 14px;
  margin:4px;
}

/* ç´™å¹é›ª */
canvas{
  position:fixed;
  top:0;left:0;
  pointer-events:none;
}

/* ===== ç­”ãˆãƒšãƒ¼ã‚¸ ===== */
.answer-page{
  display:none;
}

/* ===== PDFç”¨ ===== */
@media print{
  @page{
    size:A4 portrait;
    margin:12mm;
  }
  body{
    background:white;
    font-size:13px;
  }
  button, canvas{
    display:none;
  }

  .question{
    border:none;
    padding:6px 0;
    margin-bottom:12px;
  }

  .choices{
    display:block;
    margin-left:16px;
  }
  .choice{
    display:inline-block;
    border:none;
    background:none;
    padding:0;
    margin-right:12px;
    font-size:14px;
  }

  .answer-page{
    display:block;
    page-break-before: always;
  }
}
</style>
</head>

<body>

<h1>è‹±æ¤œ3ç´š å—ã‘èº«ãƒ»å‰ç½®è© ç©ºæ¬„åŸ‹ã‚</h1>

<div id="game"></div>

<div class="controls">
  <button onclick="shuffleAll()">ğŸ”€ ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
  <button onclick="checkAll()">âœ” ç­”ãˆåˆã‚ã›</button>
  <button onclick="window.print()">ğŸ–¨ PDF</button>
</div>

<!-- PDFå°‚ç”¨ï¼šç­”ãˆãƒšãƒ¼ã‚¸ -->
<div class="answer-page">
  <h1>ç­”ãˆ</h1>
  <ol id="answerList"></ol>
</div>

<canvas id="confetti"></canvas>

<script>
const QUESTIONS = [
 {sentence:"This bottle is made (_____) glass.", answer:"of", choices:["of","from","by","with"]},
 {sentence:"The little girl was rescued (_____) a firefighter.", answer:"by", choices:["with","from","by","to"]},
 {sentence:"The box is made (_____) paper.", answer:"of", choices:["of","with","from","by"]},
 {sentence:"The car was fixed (_____) my uncle.", answer:"by", choices:["by","with","from","to"]},
 {sentence:"Cheese is made (_____) milk.", answer:"from", choices:["of","from","by","with"]},
 {sentence:"What is this bird called (_____) French?", answer:"in", choices:["in","by","with","for"]},
 {sentence:"The song is known (_____) many young people.", answer:"to", choices:["with","for","by","to"]},
 {sentence:"The mountain was covered (_____) snow.", answer:"with", choices:["with","by","from","for"]}
];

const game = document.getElementById("game");
const confetti = document.getElementById("confetti");

let instances = [];
let currentOrder = [];
let anim = null;

function shuffle(arr){
  return arr.slice().sort(()=>Math.random()-0.5);
}

/* ===== å•é¡Œè¡¨ç¤º ===== */
function render(){
  game.innerHTML="";
  instances=[];
  currentOrder = shuffle(QUESTIONS);

  currentOrder.forEach(q=>{
    const box=document.createElement("div");
    box.className="question";

    const sentenceHTML = q.sentence.replace(
      "_____","<span class='blank'></span>"
    );

    box.innerHTML = `
      <div class="sentence">${sentenceHTML}</div>
      <div class="choices"></div>
      <div class="speak">
        <button onclick="speak('${q.sentence.replace("_____",q.answer)}',1)">ğŸ”Š æ™®é€š</button>
        <button onclick="speak('${q.sentence.replace("_____",q.answer)}',0.6)">ğŸ¢ ã‚†ã£ãã‚Š</button>
      </div>
    `;
    game.appendChild(box);

    const blank = box.querySelector(".blank");
    const choicesDiv = box.querySelector(".choices");
    let selected = null;

    shuffle(q.choices).forEach(c=>{
      const ch=document.createElement("div");
      ch.className="choice";
      ch.textContent=c;
      ch.onclick=()=>{
        [...choicesDiv.children].forEach(x=>x.classList.remove("selected"));
        ch.classList.add("selected");
        blank.textContent=c;
        selected=c;
      };
      choicesDiv.appendChild(ch);
    });

    instances.push({box, selectedRef:()=>selected, answer:q.answer});
  });

  renderAnswers();
}

/* ===== PDFç”¨ ç­”ãˆ ===== */
function renderAnswers(){
  const list = document.getElementById("answerList");
  list.innerHTML = "";

  currentOrder.forEach(q=>{
    const li=document.createElement("li");
    li.textContent = q.answer;
    list.appendChild(li);
  });
}

/* ===== ç­”ãˆåˆã‚ã› ===== */
function checkAll(){
  let allCorrect=true;
  instances.forEach(i=>{
    if(i.selectedRef()!==i.answer){
      i.box.classList.add("wrong");
      allCorrect=false;
    }else{
      i.box.classList.remove("wrong");
      i.box.querySelector(".speak").style.display="block";
    }
  });
  if(allCorrect) startConfetti();
}

/* ===== èª­ã¿ä¸Šã’ ===== */
function speak(text, rate){
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(text);
  u.lang="en-US";
  u.rate=rate;
  speechSynthesis.speak(u);
}

/* ===== ç´™å¹é›ª ===== */
function startConfetti(){
  stopConfetti();
  const ctx=confetti.getContext("2d");
  confetti.width=innerWidth;
  confetti.height=innerHeight;

  const p=[...Array(120)].map(()=>({
    x:Math.random()*confetti.width,
    y:Math.random()*confetti.height,
    r:Math.random()*4+3,
    c:`hsl(${Math.random()*360},100%,50%)`
  }));

  function draw(){
    ctx.clearRect(0,0,confetti.width,confetti.height);
    p.forEach(o=>{
      ctx.fillStyle=o.c;
      ctx.beginPath();
      ctx.arc(o.x,o.y,o.r,0,Math.PI*2);
      ctx.fill();
      o.y+=2;
      if(o.y>confetti.height) o.y=0;
    });
    anim=requestAnimationFrame(draw);
  }
  draw();
  setTimeout(stopConfetti,5000);
}

function stopConfetti(){
  if(anim){
    cancelAnimationFrame(anim);
    anim=null;
  }
  confetti.getContext("2d").clearRect(0,0,confetti.width,confetti.height);
}

/* ===== ã‚·ãƒ£ãƒƒãƒ•ãƒ« ===== */
function shuffleAll(){
  stopConfetti();
  render();
}

/* åˆæœŸè¡¨ç¤º */
render();
</script>

</body>
</html>
