<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>è‹±æ¤œ3ç´š å—ã‘èº« ä¸¦ã¹æ›¿ãˆ</title>

<style>
body{
  font-family:"Hiragino Maru Gothic ProN","Hiragino Maru Gothic",sans-serif;
  background:#f6f6f6;
  padding:16px;
}
h1{
  text-align:center;
  font-size:20px;
  margin-bottom:20px;
}
.question{
  background:#fff;
  padding:16px;
  margin-bottom:24px;
  border-radius:14px;
  border:3px solid transparent;
}
.question.wrong{
  border-color:#e74c3c;
  background:#fff0f0;
}
.jp{
  font-size:14px;
  margin-bottom:6px;
}

/* PDFå°‚ç”¨ */
.print-only{ display:none; }
.lines{ margin-top:8px; }
.line{
  border-bottom:1.8px solid #333;
  height:22px;
  margin-bottom:6px;
}

/* ã‚«ãƒ¼ãƒ‰ */
.card-pool{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  padding:12px;
  border:2px dashed #bbb;
  border-radius:12px;
  background:#fafafa;
  margin-bottom:12px;
}
.slots{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  padding:12px;
  border:2px dashed #bbb;
  border-radius:12px;
  background:#eef6ff;
}
.slot{
  width:70px;
  height:42px;
  border:2px dashed #ccc;
  border-radius:8px;
}
.card{
  min-width:60px;
  height:40px;
  padding:0 10px;
  border:2px solid #999;
  border-radius:10px;
  background:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:15px;
  cursor:pointer;
  user-select:none;
  white-space:nowrap;
}

/* ãƒœã‚¿ãƒ³ */
.controls{
  text-align:center;
  margin:20px 0;
}
button{
  font-size:15px;
  padding:6px 12px;
  margin:4px;
}
.speak-btn{ display:none; }

/* ç´™å¹é›ª */
canvas{
  position:fixed;
  top:0;left:0;
  pointer-events:none;
}

/* PDFãƒ¢ãƒ¼ãƒ‰ */
@media print{
  body{ background:white; }
  button, .card-pool, .slots, canvas{ display:none; }
  .print-only{ display:block; }
  .question{ page-break-inside:avoid; }
}
@media print{
  @page{
    size: A4 portrait;
    margin: 12mm;
  }

  body{
    font-size: 12px;
  }

  .question{
    page-break-inside: avoid;
    margin-bottom: 12px;
    padding: 10px;
  }

  h1{
    font-size: 16px;
    margin-bottom: 12px;
  }
}

</style>
</head>

<body>

<h1>è‹±æ¤œ3ç´š å—ã‘èº« ä¸¦ã¹æ›¿ãˆ</h1>

<div id="game"></div>

<div class="controls">
  <button onclick="shuffleAll()">ğŸ”€ ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
  <button onclick="checkAll()">âœ” ä¸¸ã¤ã‘</button>
  <button onclick="window.print()">ğŸ–¨ PDF</button>
</div>

<canvas id="confetti"></canvas>

<script>
const QUESTIONS = [
 {jp:"æµ·è—»ã¯å¤šãã®å›½ã§é£Ÿã¹ã‚‰ã‚Œã¦ã„ã¾ã›ã‚“ã€‚", en:["Seaweed","is","not","eaten","in","many","countries","."]},
 {jp:"ç±³ã¯å¤šãã®å›½ã§é£Ÿã¹ã‚‰ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ", en:["Is","rice","eaten","in","many","countries","?"]},
 {jp:"ãã®ãƒˆã‚¤ãƒ¬ã¯æ˜¨æ—¥æƒé™¤ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚", en:["The","restroom","was","not","cleaned","yesterday","."]},
 {jp:"ã“ã‚Œã‚‰ã®èŠ±ã¯ã‚ãªãŸã®åº­ã§è‚²ã¦ã‚‰ã‚Œã¾ã—ãŸã‹ï¼Ÿ", en:["Were","these","flowers","grown","in","your","garden","?"]},
 {jp:"ãƒ¯ã‚¤ãƒ³ã¯ã¶ã©ã†ã‹ã‚‰ä½œã‚‰ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ", en:["Is","wine","made","from","grapes","?"]},
 {jp:"ãªãœãã®å°‘å¹´ã¯æ³¥ã ã‚‰ã‘ã ã£ãŸã®ã§ã™ã‹ï¼Ÿ", en:["Why","was","the","boy","covered","with","mud","?"]},
 {jp:"ã“ã‚Œã‚‰ã®ã‚¯ãƒƒã‚­ãƒ¼ã¯ã‚¤ã‚¿ãƒªã‚¢ã§ä½œã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚", en:["These","cookies","were","not","made","in","Italy","."]},
 {jp:"ã“ã‚Œã‚‰ã®ã‚¯ãƒƒã‚­ãƒ¼ã¯ã©ã“ã§ä½œã‚‰ã‚Œã¾ã—ãŸã‹ï¼Ÿ", en:["Where","were","these","cookies","made","?"]}
];

const game=document.getElementById("game");
const confetti=document.getElementById("confetti");
let instances=[];
let anim=null;

/* é€šå¸¸ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆå•é¡Œé †ç”¨ï¼‰ */
function shuffle(arr){
  return arr.slice().sort(()=>Math.random()-0.5);
}

/* å¼·ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆå˜èªç”¨ï¼šå¿…ãšå…ƒã¨é•ã†ï¼‰ */
function strongShuffle(arr){
  let shuffled;
  do{
    shuffled = arr.slice().sort(()=>Math.random()-0.5);
  }while(shuffled.join(" ") === arr.join(" "));
  return shuffled;
}

function shuffleAll(){
  stopConfetti();
  game.innerHTML="";
  instances=[];

  shuffle(QUESTIONS).forEach(q=>{
    const shuffledWords = strongShuffle(q.en);

    const box=document.createElement("div");
    box.className="question";
    box.innerHTML=`
      <div class="jp">${q.jp}</div>

      <div class="print-only">
        <div>${shuffledWords.join(" / ")}</div>
        <div class="lines">
          <div class="line"></div>
        </div>
      </div>

      <button class="speak-btn normal">ğŸ”Š æ™®é€š</button>
      <button class="speak-btn slow">ğŸ¢ ã‚†ã£ãã‚Š</button>

      <div class="card-pool"></div>
      <div class="slots"></div>
    `;
    game.appendChild(box);

    const pool=box.querySelector(".card-pool");
    const slots=box.querySelector(".slots");
    const speakBtns=box.querySelectorAll(".speak-btn");

    q.en.forEach(()=>slots.appendChild(document.createElement("div")).className="slot");

    shuffledWords.forEach(w=>{
      const c=document.createElement("div");
      c.className="card";
      c.textContent=w;
      pool.appendChild(c);
      c.onclick=()=>{
        if(c.parentElement===pool){
          const e=[...slots.children].find(s=>!s.firstChild);
          if(e) e.appendChild(c);
        }else{
          pool.appendChild(c);
        }
      };
    });

    const answer=q.en.join(" ");
    speakBtns[0].onclick=()=>speak(answer,1.0);
    speakBtns[1].onclick=()=>speak(answer,0.6);

    instances.push({box,slots,answer,speakBtns});
  });
}

function speak(text, rate){
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(text);
  u.lang="en-US";
  u.rate=rate;
  speechSynthesis.speak(u);
}

function checkAll(){
  let allCorrect=true;
  instances.forEach(i=>{
    const text=[...i.slots.children].map(s=>s.firstChild?s.firstChild.textContent:"").join(" ");
    if(text!==i.answer){
      i.box.classList.add("wrong");
      allCorrect=false;
    }else{
      i.box.classList.remove("wrong");
      i.speakBtns.forEach(b=>b.style.display="inline-block");
    }
  });
  if(allCorrect) startConfetti();
}

/* ç´™å¹é›ªï¼š5ç§’ */
function startConfetti(){
  stopConfetti();
  const ctx=confetti.getContext("2d");
  confetti.width=innerWidth;
  confetti.height=innerHeight;

  const p=[...Array(120)].map(()=>({
    x:Math.random()*confetti.width,
    y:Math.random()*confetti.height,
    r:Math.random()*4+3,
    c:`hsl(${Math.random()*360},100%,50%)`
  }));

  function draw(){
    ctx.clearRect(0,0,confetti.width,confetti.height);
    p.forEach(o=>{
      ctx.fillStyle=o.c;
      ctx.beginPath();
      ctx.arc(o.x,o.y,o.r,0,Math.PI*2);
      ctx.fill();
      o.y+=2;
      if(o.y>confetti.height) o.y=0;
    });
    anim=requestAnimationFrame(draw);
  }
  draw();
  setTimeout(stopConfetti,5000);
}

function stopConfetti(){
  if(anim){
    cancelAnimationFrame(anim);
    anim=null;
  }
  const ctx=confetti.getContext("2d");
  ctx.clearRect(0,0,confetti.width,confetti.height);
}

/* åˆæœŸè¡¨ç¤º */
shuffleAll();
</script>

</body>
</html>
