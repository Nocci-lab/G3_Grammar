<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>è‹±æ¤œ3ç´š å—ã‘èº« ä¸¦ã¹æ›¿ãˆ</title>

<style>
body{
  font-family:"Hiragino Maru Gothic ProN","Hiragino Maru Gothic",sans-serif;
  background:#f6f6f6;
  padding:16px;
}
h1{
  text-align:center;
  font-size:20px;
  margin-bottom:20px;
}
.question{
  background:#fff;
  padding:16px;
  margin-bottom:24px;
  border-radius:14px;
  border:3px solid transparent;
}
.question.wrong{
  border-color:#e74c3c;
  background:#fff0f0;
}
.jp{
  font-size:14px;
  margin-bottom:6px;
}

/* PDFå°‚ç”¨ */
.print-only{ display:none; }
.lines{ margin-top:8px; }
.line{
  border-bottom:1.8px solid #333;
  height:22px;
  margin-bottom:6px;
}

/* ã‚«ãƒ¼ãƒ‰ */
.card-pool, .slots{ display:flex; flex-wrap:wrap; gap:10px; }
.card-pool{
  padding:12px;
  border:2px dashed #bbb;
  border-radius:12px;
  background:#fafafa;
  margin-bottom:12px;
}
.slots{
  padding:12px;
  border:2px dashed #bbb;
  border-radius:12px;
  background:#eef6ff;
}
.slot{
  width:70px;
  height:42px;
  border:2px dashed #ccc;
  border-radius:8px;
}
.card{
  min-width:60px;
  height:40px;
  padding:0 10px;
  border:2px solid #999;
  border-radius:10px;
  background:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:15px;
  cursor:pointer;
  user-select:none;
  white-space:nowrap;
}

/* ãƒœã‚¿ãƒ³ */
.controls{ text-align:center; margin:20px 0; }
button{ font-size:15px; padding:6px 12px; margin:4px; }
.speak-btn{ display:none; }

/* ç´™å¹é›ª */
canvas{ position:fixed; top:0; left:0; pointer-events:none; }

/* ===== ç­”ãˆãƒšãƒ¼ã‚¸ ===== */
.answer-page{ display:none; }

/* ===== PDF ===== */
@media print{
  @page{ size:A4 portrait; margin:12mm; }
  body{ background:white; font-size:12px; }
  button, .card-pool, .slots, canvas{ display:none; }
  .print-only{ display:block; }
  .question{ page-break-inside:avoid; }

  .answer-page{
    display:block;
    page-break-before:always;
  }
}
</style>
</head>

<body>

<h1>è‹±æ¤œ3ç´š å—ã‘èº« ä¸¦ã¹æ›¿ãˆ</h1>

<div id="game"></div>

<div class="controls">
  <button onclick="shuffleAll()">ğŸ”€ ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
  <button onclick="checkAll()">âœ” ä¸¸ã¤ã‘</button>
  <button onclick="window.print()">ğŸ–¨ PDF</button>
</div>

<!-- PDFç”¨ï¼šç­”ãˆãƒšãƒ¼ã‚¸ -->
<div class="answer-page">
  <h1>ç­”ãˆ</h1>
  <ol id="answerList"></ol>
</div>

<canvas id="confetti"></canvas>

<script>
const QUESTIONS = [
 {jp:"æµ·è—»ã¯å¤šãã®å›½ã§é£Ÿã¹ã‚‰ã‚Œã¦ã„ã¾ã›ã‚“ã€‚", en:["Seaweed","is","not","eaten","in","many","countries","."]},
 {jp:"ç±³ã¯å¤šãã®å›½ã§é£Ÿã¹ã‚‰ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ", en:["Is","rice","eaten","in","many","countries","?"]},
 {jp:"ãã®ãƒˆã‚¤ãƒ¬ã¯æ˜¨æ—¥æƒé™¤ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚", en:["The","restroom","was","not","cleaned","yesterday","."]},
 {jp:"ã“ã‚Œã‚‰ã®èŠ±ã¯ã‚ãªãŸã®åº­ã§è‚²ã¦ã‚‰ã‚Œã¾ã—ãŸã‹ï¼Ÿ", en:["Were","these","flowers","grown","in","your","garden","?"]},
 {jp:"ãƒ¯ã‚¤ãƒ³ã¯ã¶ã©ã†ã‹ã‚‰ä½œã‚‰ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ", en:["Is","wine","made","from","grapes","?"]},
 {jp:"ãªãœãã®å°‘å¹´ã¯æ³¥ã ã‚‰ã‘ã ã£ãŸã®ã§ã™ã‹ï¼Ÿ", en:["Why","was","the","boy","covered","with","mud","?"]},
 {jp:"ã“ã‚Œã‚‰ã®ã‚¯ãƒƒã‚­ãƒ¼ã¯ã‚¤ã‚¿ãƒªã‚¢ã§ä½œã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚", en:["These","cookies","were","not","made","in","Italy","."]},
 {jp:"ã“ã‚Œã‚‰ã®ã‚¯ãƒƒã‚­ãƒ¼ã¯ã©ã“ã§ä½œã‚‰ã‚Œã¾ã—ãŸã‹ï¼Ÿ", en:["Where","were","these","cookies","made","?"]}
];

const game=document.getElementById("game");
const answerList=document.getElementById("answerList");
const confetti=document.getElementById("confetti");

let instances=[];
let currentOrder=[];
let anim=null;

function shuffle(arr){
  return arr.slice().sort(()=>Math.random()-0.5);
}
function strongShuffle(arr){
  let s;
  do{ s=shuffle(arr); }while(s.join("")===arr.join(""));
  return s;
}

function shuffleAll(){
  stopConfetti();
  game.innerHTML="";
  answerList.innerHTML="";
  instances=[];

  currentOrder = shuffle(QUESTIONS);

  currentOrder.forEach(q=>{
    const shuffledWords = strongShuffle(q.en);
    const box=document.createElement("div");
    box.className="question";
    box.innerHTML=`
      <div class="jp">${q.jp}</div>

      <div class="print-only">
        <div>${shuffledWords.join(" / ")}</div>
        <div class="lines"><div class="line"></div></div>
      </div>

      <div class="card-pool"></div>
      <div class="slots"></div>
    `;
    game.appendChild(box);

    const pool=box.querySelector(".card-pool");
    const slots=box.querySelector(".slots");

    q.en.forEach(()=>slots.appendChild(document.createElement("div")).className="slot");

    shuffledWords.forEach(w=>{
      const c=document.createElement("div");
      c.className="card";
      c.textContent=w;
      pool.appendChild(c);
      c.onclick=()=>{
        if(c.parentElement===pool){
          const e=[...slots.children].find(s=>!s.firstChild);
          if(e) e.appendChild(c);
        }else{
          pool.appendChild(c);
        }
      };
    });

    instances.push({box,slots,answer:q.en.join(" ")});

    /* ç­”ãˆãƒšãƒ¼ã‚¸ç”¨ */
    const li=document.createElement("li");
    li.textContent=q.en.join(" ");
    answerList.appendChild(li);
  });
}

function checkAll(){
  let ok=true;
  instances.forEach(i=>{
    const text=[...i.slots.children].map(s=>s.firstChild?s.firstChild.textContent:"").join(" ");
    if(text!==i.answer){
      i.box.classList.add("wrong");
      ok=false;
    }else{
      i.box.classList.remove("wrong");
    }
  });
  if(ok) startConfetti();
}

/* ç´™å¹é›ª */
function startConfetti(){
  stopConfetti();
  const ctx=confetti.getContext("2d");
  confetti.width=innerWidth;
  confetti.height=innerHeight;
  const p=[...Array(120)].map(()=>({x:Math.random()*innerWidth,y:Math.random()*innerHeight,r:4,c:`hsl(${Math.random()*360},100%,50%)`}));
  function draw(){
    ctx.clearRect(0,0,innerWidth,innerHeight);
    p.forEach(o=>{ctx.fillStyle=o.c;ctx.beginPath();ctx.arc(o.x,o.y,o.r,0,Math.PI*2);ctx.fill();o.y+=2;});
    anim=requestAnimationFrame(draw);
  }
  draw();
  setTimeout(stopConfetti,5000);
}
function stopConfetti(){
  if(anim){cancelAnimationFrame(anim);anim=null;}
  confetti.getContext("2d").clearRect(0,0,innerWidth,innerHeight);
}

/* åˆæœŸè¡¨ç¤º */
shuffleAll();
</script>

</body>
</html>
