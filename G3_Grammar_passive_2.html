<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>è‹±æ¤œ3ç´š å—ã‘èº« ä¸¦ã¹æ›¿ãˆ</title>

<style>
body{
  font-family:"Hiragino Maru Gothic ProN","Hiragino Maru Gothic",sans-serif;
  background:#f5f5f5;
  padding:16px;
}
h1{
  text-align:center;
  font-size:20px;
  margin-bottom:20px;
}
.question{
  background:#fff;
  padding:16px;
  margin-bottom:26px;
  border-radius:14px;
  border:3px solid transparent;
}
.question.wrong{
  border-color:#e74c3c;
  background:#fff0f0;
}
.jp{
  font-size:14px;
  margin-bottom:10px;
}

/* ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ« */
.card-pool{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  padding:12px;
  border:2px dashed #bbb;
  border-radius:12px;
  background:#fafafa;
  margin-bottom:14px;
}

/* ã‚¹ãƒ­ãƒƒãƒˆ */
.slots{
  display:flex;
  gap:10px;
  padding:12px;
  border:2px dashed #bbb;
  border-radius:12px;
  background:#eef6ff;
}
.slot{
  width:72px;
  height:44px;
  border:2px dashed #ccc;
  border-radius:8px;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ã‚«ãƒ¼ãƒ‰ */
.card{
  min-width:60px;
  height:40px;
  padding:0 10px;
  border:2px solid #999;
  border-radius:10px;
  background:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:15px;
  cursor:pointer;
  user-select:none;
  white-space:nowrap;
}

/* ãƒœã‚¿ãƒ³ */
.controls{
  text-align:center;
  margin:20px 0;
}
button{
  font-size:15px;
  padding:8px 14px;
  margin:6px 4px;
}

/* ç´™å¹é›ª */
canvas{
  position:fixed;
  top:0;left:0;
  pointer-events:none;
}
</style>
</head>

<body>

<h1>è‹±æ¤œ3ç´š å—ã‘èº« ä¸¦ã¹æ›¿ãˆ</h1>

<div id="game"></div>

<div class="controls">
  <button onclick="shuffleAll()">ğŸ”€ å•é¡Œã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
  <button onclick="checkAll()">ä¸¸ã¤ã‘</button>
</div>

<canvas id="confetti"></canvas>

<script>
const QUESTIONS = [
  {jp:"ã“ã®éƒ¨å±‹ã¯æ¯æ—¥ä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚",
   en:["This","room","is","used","every","day","."]},

  {jp:"ã“ã®ã‚¯ãƒƒã‚­ãƒ¼ã¯æ¯ã«ã‚ˆã£ã¦ä½œã‚‰ã‚Œã¾ã—ãŸã€‚",
   en:["These","cookies","were","made","by","my","mother","."]},

  {jp:"ã“ã®ã‚²ãƒ¼ãƒ ã¯æ”¾èª²å¾Œã«éŠã°ã‚Œã¾ã™ã€‚",
   en:["This","game","is","played","after","school","."]},

  {jp:"ã“ã®æœ¬ã¯æœ‰åãªä½œå®¶ã«ã‚ˆã£ã¦æ›¸ã‹ã‚Œã¾ã—ãŸã€‚",
   en:["This","book","was","written","by","a","famous","writer","."]},

  {jp:"æ•™å®¤ã¯æ”¾èª²å¾Œã«æƒé™¤ã•ã‚Œã¾ã—ãŸã€‚",
   en:["The","classroom","was","cleaned","after","school","."]},

  {jp:"ã“ã®æ­Œã¯å¤šãã®äººã«æ„›ã•ã‚Œã¦ã„ã¾ã™ã€‚",
   en:["This","song","is","loved","by","many","people","."]},

  {jp:"ãã®çª“ã¯åµã®é–“ã«å£Šã•ã‚Œã¾ã—ãŸã€‚",
   en:["The","window","was","broken","during","the","storm","."]},

  {jp:"ãã®æ©‹ã¯10å¹´å‰ã«å»ºã¦ã‚‰ã‚Œã¾ã—ãŸã€‚",
   en:["The","bridge","was","built","ten","years","ago","."]},

  {jp:"è‹±èªã¯ä¸–ç•Œä¸­ã§è©±ã•ã‚Œã¦ã„ã¾ã™ã€‚",
   en:["English","is","spoken","all","over","the","world","."]},

  {jp:"ç±³ã¯ã‚¢ã‚¸ã‚¢ã®å¤šãã®å›½ã§é£Ÿã¹ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚",
   en:["Rice","is","eaten","in","many","countries","in","Asia","."]}
];

let instances=[];

function shuffle(arr){
  return arr.slice().sort(()=>Math.random()-0.5);
}

/* ç­”ãˆã¨åŒã˜é †ã«ãªã‚‰ãªã„ã‚·ãƒ£ãƒƒãƒ•ãƒ« */
function shuffledNotAnswer(words){
  let arr;
  do{
    arr = shuffle(words);
  }while(arr.join(" ") === words.join(" "));
  return arr;
}

function createGame(){
  const game=document.getElementById("game");
  game.innerHTML="";
  instances=[];

  shuffle(QUESTIONS).forEach(q=>{
    const box=document.createElement("div");
    box.className="question";
    box.innerHTML=`
      <div class="jp">${q.jp}</div>
      <div class="card-pool"></div>
      <div class="slots"></div>
    `;
    game.appendChild(box);

    const pool=box.querySelector(".card-pool");
    const slots=box.querySelector(".slots");

    q.en.forEach(()=>slots.appendChild(document.createElement("div")).className="slot");

    shuffledNotAnswer(q.en).forEach(word=>{
      const c=document.createElement("div");
      c.className="card";
      c.textContent=word;
      pool.appendChild(c);

      c.onclick=()=>{
        if(c.parentElement===pool){
          const empty=[...slots.children].find(s=>s.children.length===0);
          if(empty) empty.appendChild(c);
        }else{
          pool.appendChild(c);
        }
        updateCapital(slots);
      };
    });

    instances.push({
      box,
      pool,
      slots,
      answer:q.en.map(w=>w.toLowerCase()).join(" ")
    });
  });
}

function updateCapital(slots){
  [...slots.children].forEach((s,i)=>{
    if(s.firstChild){
      let t=s.firstChild.textContent;
      if(i===0 && t!=="."){
        s.firstChild.textContent=t[0].toUpperCase()+t.slice(1);
      }
    }
  });
}

function checkAll(){
  let allOK=true;

  instances.forEach(ins=>{
    const text=[...ins.slots.children]
      .map(s=>s.firstChild ? s.firstChild.textContent.toLowerCase() : "")
      .join(" ");

    if(text!==ins.answer){
      allOK=false;
      ins.box.classList.add("wrong");
      [...ins.slots.children].forEach(s=>{
        if(s.firstChild){
          ins.pool.appendChild(s.firstChild);
        }
      });
    }else{
      ins.box.classList.remove("wrong");
    }
  });

  if(allOK){
    startConfetti();
    alert("ğŸ‰ å…¨å•æ­£è§£ï¼");
  }
}

/* ç´™å¹é›ªï¼ˆ5ç§’ï¼‰ */
let anim,timer;
function startConfetti(){
  stopConfetti();
  const cv=document.getElementById("confetti");
  const ctx=cv.getContext("2d");
  cv.width=innerWidth;
  cv.height=innerHeight;

  const p=[...Array(120)].map(()=>({
    x:Math.random()*cv.width,
    y:Math.random()*cv.height,
    r:Math.random()*4+3,
    c:`hsl(${Math.random()*360},100%,50%)`
  }));

  function draw(){
    ctx.clearRect(0,0,cv.width,cv.height);
    p.forEach(o=>{
      ctx.beginPath();
      ctx.fillStyle=o.c;
      ctx.arc(o.x,o.y,o.r,0,Math.PI*2);
      ctx.fill();
      o.y+=2;
      if(o.y>cv.height) o.y=0;
    });
    anim=requestAnimationFrame(draw);
  }
  draw();
  timer=setTimeout(stopConfetti,5000);
}

function stopConfetti(){
  cancelAnimationFrame(anim);
  clearTimeout(timer);
  const ctx=document.getElementById("confetti").getContext("2d");
  ctx.clearRect(0,0,innerWidth,innerHeight);
}

function shuffleAll(){
  createGame();
}

createGame();
</script>

</body>
</html>
